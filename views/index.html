<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>BDO</title>

    <script src="assets/jquery-3.6.0.min.js"></script>
    <script src="assets/process_catalog.js"></script>
    <script src="assets/state_catalog.js"></script>
    <script src="assets/waste_catalog.js"></script>
    <script src="assets/app.js?v=107"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
  </head>

  <body>
    <div class="ui grid container">
      <div class="sixteen wide column">
        <div class="ui menu">
          <a class="ui item" href="/">Katalog</a>
          <a class="ui item floated right" href="/">Zgłoś instalację</a>
        </div>
      </div>

      <div class="six wide column">
        <div class="ui fluid search card">
          <template id="code-desc-row-template">
            <tr>
              <td class="code"></td>
              <td class="description"></td>
            </tr>
          </template>
          <template id="code-desc-header-row-template">
            <tr class="selected-waste-header">
              <th class="code"></th>
              <th class="description"></th>
            </tr>
          </template>
          <div class="content">
            <div class="header">Szukaj instalacji</div>
          </div>
          <div class="content">
            <form class="ui form">
              <div class="field">
                <label>Kod odpadu</label>
                <div class="ui icon input">
                  <input type="text" name="waste" placeholder="xxxxxx">
                  <i class="inverted circular search waste link icon"></i>
                </div>
                <div class="ui pointing label waste-hint code-a">Podaj kod odpadu</div>
                <div class="ui pointing label waste-hint code-b"></div>
                <div class="ui pointing label waste-hint code-c"></div>
              </div>
              <div class="field">
                <label>Proces przetwarzania</label>
                <div class="ui icon input">
                  <input type="text" name="process" placeholder="R1">
                  <i class="inverted circular search process link icon"></i>
                </div>
                <div class="ui pointing label process-hint">Podaj kod procesu przetwarzania</div>
              </div>
              <div class="field">
                <label>Województwo</label>
                <div class="ui icon input">
                  <select class="ui search selection simple dropdown" name="state">
                    <option value=""></option>
                    <option value="02">dolnośląskie</option>
                    <option value="04">kujawsko-pomorskie</option>
                    <option value="06">lubelskie</option>
                    <option value="08">lubuskie</option>
                    <option value="10">łódzkie</option>
                    <option value="12">małopolskie</option>
                    <option value="14">mazowieckie</option>
                    <option value="16">opolskie</option>
                    <option value="18">podkarpackie</option>
                    <option value="20">podlaskie</option>
                    <option value="22">pomorskie</option>
                    <option value="24">śląskie</option>
                    <option value="26">świętokrzyskie</option>
                    <option value="28">warmińsko-mazurskie</option>
                    <option value="30">wielkopolskie</option>
                    <option value="32">zachodniopomorskie</option>
                  </select>
                  <!--<i class="inverted circular location arrow link icon"></i>-->
                </div>
              </div>
              <button class="ui button" type="submit">Szukaj</button>
              <button class="ui button" type="reset">Wyczyść</button>
            </form>
          </div>
          <!--
          <iframe width="450" height="250" frameborder="0" style="border:0" referrerpolicy="no-referrer-when-downgrade" src="https://www.google.com/maps/embed/v1/MAP_MODE?key=YOUR_API_KEY&PARAMETERS" allowfullscreen>
          </iframe>
          -->
        </div>

        <div class="ui modal processes">
          <div class="header">
            Wyszukaj proces przetwarzania
          </div>
          <div class="scrolling content">
            <table class="ui selectable compact celled table">
              <thead>
                <tr>
                  <th>Kod</th>
                  <th>Opis</th>
                </tr>
              </thead>
              <tbody class="process-list">
              </tbody>
            </table>
          </div>
          <div class="actions">
            <div class="ui basic cancel button">
              <i class="checkmark icon"></i>
              Anuluj
            </div>
          </div>
        </div>

        <div class="ui modal wastes">
          <div class="header">
            Wyszukaj kod odpadu
          </div>
          <div class="scrolling content">
            <table class="ui selectable compact celled table">
              <thead class="waste-list-header">
                <tr>
                  <th>Kod</th>
                  <th>Opis</th>
                </tr>
              </thead>
              <tbody class="waste-list">
              </tbody>
            </table>
          </div>
          <div class="actions">
            <div class="ui basic cancel button">
              <i class="checkmark icon"></i>
              Anuluj
            </div>
          </div>
        </div>
      </div>

      <div class="ten wide column" id="map">
        <img class="ui fluid bordered image" src="assets/map.png" />
      </div>

      <div class="sixteen wide column">

        <template id="installation-capability-template">
          <div class="ui label">
            <span class="ui label waste-code"></span>
            <span class="ui label process-code"></span>
            <span class="ui label quantity"></span>
          </div>
        </template>

        <template id="installation-template">
          <div class="ui fluid card installation">
            <div class="content">
              <div class="header name"></div>
              <div class="meta address"></div>
              <div class="description">
                <div class="ui large labels capabilities">
                </div>
              </div>
            </div>
          </div>
        </template>

        <div class="ui two cards installations">
        </div>
      </div>
    </div>
  </body>

  <script type="text/javascript">
    (g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));e.set("libraries",[...r]+"");for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);a.src=`https://maps.${c}apis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})({
      key: "{{.GoogleMapsApiKey}}",
      v: "weekly",
      // Use the 'v' parameter to indicate the version to use (weekly, beta, alpha, etc.).
      // Add other bootstrap parameters as needed, using camel case.
    });

    $(function() {
      let map;

      async function initMap() {
        const { Map } = await google.maps.importLibrary("maps");

        map = new Map(document.getElementById("map"), {
          //center: { lat: 50.05, lng: 21.41 },
          center: { lat: 52.24, lng: 21.00 },
          zoom: 6,
        });
      }
      let installationsView
      let searchView

      initMap().then(()=> {
        installationsView = new InstallationsView('.installations', map)
        searchView = new SearchView('.ui.search.card', installationsView)

        //$('.dropdown').dropdown()
        $('.search.process').click((event) => {
          let processSelectorView = new ProcessSelectorView
          processSelectorView.load((code, desc) => {
            searchView.setProcess(code, desc)
            processSelectorView.hide()
          })
          processSelectorView.show()
        })

        $('.search.waste').click((event) => {
          var wasteListView = new WasteListView
          wasteListView.load((code, desc) => {
            wasteListView.select(code, desc)
            wasteListView.load((code, desc) => {
              wasteListView.select(code, desc)
              wasteListView.load((code, desc) => {
                searchView.setWaste(wasteListView.selectedCode, ...wasteListView.selectedDescs)
                wasteListView.hide()
              })
            })
          })
          wasteListView.show()
        })
      })

    })
  </script>
</html>
